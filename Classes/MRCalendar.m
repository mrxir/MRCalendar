//
//  MRCalendar.m
//  Calendar
//
//  Created by üçâ on 2017/6/1.
//  Copyright ¬© 2017Âπ¥ üçâ. All rights reserved.
//

#import "MRCalendar.h"

#import "MRCalendarItem.h"

#import "MRCalendarMonthItem.h"

IB_DESIGNABLE

@interface MRCalendar ()<UICollectionViewDataSource, UICollectionViewDelegate, UICollectionViewDelegateFlowLayout>

@property (nonatomic, strong) NSArray *monthArray;

@property (nonatomic, strong) NSArray *dayArray;

@property (nonatomic, strong) NSArray *segmentationDayArray;

@property (nonatomic, strong) NSDictionary *itemCoverViewStyleDictionary;

@end

@implementation MRCalendar

#pragma mark - PUBLIC GETTER METHOD

+ (NSCalendar *)sharedCalendar
{
    static NSCalendar *s_calendar = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        s_calendar = [NSCalendar currentCalendar];
        [s_calendar setFirstWeekday:1];
    });
    
    return s_calendar;
}

+ (NSDateComponents *)getDateComponentsWithDate:(NSDate *)date
{
    NSCalendarUnit unit = NSCalendarUnitYear|NSCalendarUnitMonth|NSCalendarUnitDay|NSCalendarUnitWeekday;
    
    NSDateComponents *components = [[MRCalendar sharedCalendar] components:unit fromDate:date];
    
    return components;

}

+ (NSDate *)getDateWithDateComponents:(NSDateComponents *)components
{
    NSDate *date = [[MRCalendar sharedCalendar] dateFromComponents:components];
    
    return date;
}

+ (NSRange)getCalendarRangeOfUnit:(NSCalendarUnit)smaller inUnit:(NSCalendarUnit)larger forDate:(NSDate *)date
{
    NSRange range = [[MRCalendar sharedCalendar] rangeOfUnit:smaller inUnit:larger forDate:date];
    
    return range;
}

#pragma mark - INIT

- (instancetype)initWithCoder:(NSCoder *)aDecoder
{
    if (self = [super initWithCoder:aDecoder]) {
        [self initialize];
    }
    return self;
}

- (instancetype)initWithFrame:(CGRect)frame collectionViewLayout:(UICollectionViewLayout *)layout
{
    if (self = [super initWithFrame:frame collectionViewLayout:layout]) {
        [self initialize];
    }
    return self;
}

- (void)initialize
{
    
    if (!self.collectionViewLayout) {
        self.collectionViewLayout = [[UICollectionViewFlowLayout alloc] init];
    }
    
    // ËÆæÁΩÆ‰ª£ÁêÜÊï∞ÊçÆÊ∫ê
    self.dataSource = self;
    self.delegate = self;
    
    // Ê≥®ÂÜåÈáçÁî®Ê†áËØÜ
    [self registerClass:[MRCalendarItem class] forCellWithReuseIdentifier:@"Day"];
    [self registerClass:[MRCalendarMonthItem class] forSupplementaryViewOfKind:UICollectionElementKindSectionHeader
    withReuseIdentifier:@"Month"];
    
    NSDateFormatter *yearDateFormatter = [[NSDateFormatter alloc] init];
    yearDateFormatter.dateFormat = @"yyyy";
    
    NSDateFormatter *monthDateFormatter = [[NSDateFormatter alloc] init];
    monthDateFormatter.dateFormat = @"M";
    
    NSDate *date = [NSDate date];
    
    // ÈªòËÆ§ÊòæÁ§∫ÂΩìÂπ¥
    self.year = [monthDateFormatter stringFromDate:date];
    
    // ÈªòËÆ§ÊòæÁ§∫ÂΩìÂâçÊúà‰ªΩ
    self.months = [monthDateFormatter stringFromDate:date];
    
    // ËÆæÁΩÆÈªòËÆ§ËÉåÊôØËâ≤ÁôΩËâ≤
    self.backgroundColor = [UIColor whiteColor];
    
}

#pragma mark - SETTER

- (void)setYear:(NSString *)year
{
    if (![_year isEqualToString:year]) {
     
        _year = year;
        
        [self reloadData];

    }
}

- (void)setMonths:(NSString *)months
{
    if (![_months isEqual:months]) {
    
        _months = months;
        
        NSMutableArray *monthComponents = nil;
        
        if ([months isKindOfClass:[NSString class]]) {
            
            monthComponents = [NSMutableArray arrayWithArray:[_months componentsSeparatedByString:@","]];
            [monthComponents removeObjectsInArray:@[@""]];
            
            self.monthArray = monthComponents;
            
        } else if ([months isKindOfClass:[NSArray class]]) {
            
            monthComponents = [NSMutableArray arrayWithArray:(id)_months];
            [monthComponents removeObjectsInArray:@[@""]];
            
            self.monthArray = monthComponents;
            
        } else {
            
            NSLog(@" | * Ê≥®ÊÑè: Êó†Ê≥ïËØªÂèñÂΩìÂâçÊ¨≤Âä†ËΩΩÁöÑÊúà‰ªΩÊï∞ÊçÆ");
            
        }
        
        [self reloadData];
        
    }
}

- (void)setDays:(NSString *)days
{
    if (![_days isEqual:days]) {
        
        _days = days;
        
        NSMutableArray *dayComponents = nil;
        
        if ([days isKindOfClass:[NSString class]]) {
            
            dayComponents = [NSMutableArray arrayWithArray:[_days componentsSeparatedByString:@","]];
            [dayComponents removeObjectsInArray:@[@""]];
            
            self.dayArray = dayComponents;
            
        } else if ([days isKindOfClass:[NSArray class]]) {
            
            dayComponents = [NSMutableArray arrayWithArray:(id)_days];
            [dayComponents removeObjectsInArray:@[@""]];
            
            self.dayArray = dayComponents;;
            
        } else {
            
            NSLog(@" | * Ê≥®ÊÑè: Êó†Ê≥ïËØªÂèñÂΩìÂâçÊ¨≤Âä†ËΩΩÁöÑÊó•ÊúüÊï∞ÊçÆ");
            
        }
        
        self.segmentationDayArray= [self getSegmentationArrayWithConsecutiveNumberInArray:self.dayArray];
        
        self.itemCoverViewStyleDictionary = [self getItemCoverViewStyleDictionaryWithSegmentationArray:self.segmentationDayArray];
        
        [self reloadData];
        
    }
}

- (void)setFirstWeekday:(NSUInteger)firstWeekday
{
    if (_firstWeekday != firstWeekday) {
        
        firstWeekday = MAX(firstWeekday, 1);
        
        firstWeekday = MIN(firstWeekday, 7);
        
        _firstWeekday = firstWeekday;
        
        [[MRCalendar sharedCalendar] setFirstWeekday:_firstWeekday];
        
        [self reloadData];
        
    }
}

- (void)setTopSpacing:(CGFloat)topSpacing
{
    if (_topSpacing != topSpacing) {
        
        _topSpacing = topSpacing;
        
        [self reloadData];
        
    }
}

- (void)setBottomSpacing:(CGFloat)bottomSpacing
{
    if (_bottomSpacing != bottomSpacing) {
        
        _bottomSpacing = bottomSpacing;
        
        [self reloadData];
        
    }
}

- (void)setLeftSpacing:(CGFloat)leftSpacing
{
    if (_leftSpacing != leftSpacing) {
        
        _leftSpacing = leftSpacing;
        
        CGFloat availableCollectionWidth = CGRectGetWidth(self.bounds) - _leftSpacing - _rightSpacing;
        
        CGFloat availableItemFloatWidth = availableCollectionWidth / [self getDayCountOfWeek];
        
        NSUInteger availableItemIntegerWidth = availableCollectionWidth / [self getDayCountOfWeek];
        
        BOOL availableItemWidthIsInteger = availableItemFloatWidth == availableItemIntegerWidth;
        
        if (!availableItemWidthIsInteger) {
            
            CGFloat restWidth = availableCollectionWidth - availableItemIntegerWidth * [self getDayCountOfWeek];
            
            _leftSpacing = _leftSpacing + restWidth / 2.0f;
            
            _rightSpacing = _rightSpacing + restWidth / 2.0f;
            
        }
        
        [self reloadData];
        
    }
}

- (void)setRightSpacing:(CGFloat)rightSpacing
{
    if (_rightSpacing != rightSpacing) {
        
        _rightSpacing = rightSpacing;
        
        CGFloat availableCollectionWidth = CGRectGetWidth(self.bounds) - _leftSpacing - _rightSpacing;
        
        CGFloat availableItemFloatWidth = availableCollectionWidth / [self getDayCountOfWeek];
        
        NSUInteger availableItemIntegerWidth = availableCollectionWidth / [self getDayCountOfWeek];
        
        BOOL availableItemWidthIsInteger = availableItemFloatWidth == availableItemIntegerWidth;
        
        if (!availableItemWidthIsInteger) {
            
            CGFloat restWidth = availableCollectionWidth - availableItemIntegerWidth * [self getDayCountOfWeek];
            
            _leftSpacing = _leftSpacing + restWidth / 2.0f;
            
            _rightSpacing = _rightSpacing + restWidth / 2.0f;
            
        }
        
        [self reloadData];
        
    }
}

- (void)setMinLineSpacing:(CGFloat)minLineSpacing
{
    if (_minLineSpacing != minLineSpacing) {
        
        _minLineSpacing = minLineSpacing;
        
        [self reloadData];
        
    }
}

#pragma mark - GETTER

- (NSUInteger)getDayCountOfWeek
{
    return 7;
}

- (NSMutableArray<__kindof NSNumber *> *)getWeekdays
{
    NSUInteger firstWeekday = self.firstWeekday;
    
    if (firstWeekday == 0) {
        firstWeekday = 7;
    }
    
    static NSMutableArray *mutableWeekdays = nil;
    mutableWeekdays = [NSMutableArray arrayWithObjects:@(1), @(2), @(3), @(4), @(5), @(6), @(7), nil];
    
    // Ëé∑ÂèñÂ§Ñ‰∫é first weekday ‰πãÂâçÁöÑÂØπË±°ËåÉÂõ¥
    NSRange rangeOfObjectsBeforeFirstWeekday = NSMakeRange(0, [mutableWeekdays indexOfObject:@(firstWeekday)]);
    
    // Ëé∑ÂèñËøô‰∫õÂØπË±°
    NSArray *theObjectsBeforeFirstWeekday = [mutableWeekdays subarrayWithRange:rangeOfObjectsBeforeFirstWeekday];
    
    // ÁßªÈô§Ëøô‰∫õÂØπË±°
    [mutableWeekdays removeObjectsInRange:rangeOfObjectsBeforeFirstWeekday];
    
    // Â∞ÜËøô‰∫õÂØπË±°ËøΩÂä†Âà∞Â∞æÈÉ®
    [mutableWeekdays addObjectsFromArray:theObjectsBeforeFirstWeekday];
    
    return mutableWeekdays;
}

- (NSDictionary *)getWeekdaysArabicNumberToChineseDictionary
{
    static NSDictionary *dictionary = nil;
    
    dictionary = @{@"1": @"‰∏Ä",
                   @"2": @"‰∫å",
                   @"3": @"‰∏â",
                   @"4": @"Âõõ",
                   @"5": @"‰∫î",
                   @"6": @"ÂÖ≠",
                   @"7": @"Êó•"};
    
    return dictionary;
}

- (NSDate *)getDateWithYear:(NSString *)year month:(NSString *)month day:(NSString *)day
{
    NSString *dateDescription = [NSString stringWithFormat:@"%@-%@-%@", year, month, day];
    static NSDateFormatter *dateFormatter = nil;
    dateFormatter = [[NSDateFormatter alloc] init];
    dateFormatter.dateFormat = @"yyyy-M-d";
    NSDate *date = [dateFormatter dateFromString:dateDescription];
    return date;
    
}

// ËøôÈÉ®ÂàÜÊï∞ÊçÆÂ∫îËØ•Âú®ËØ• section ËÆ°ÁÆóÂÆå‰πãÂêé‰øùÂ≠òËµ∑Êù•, ÂΩì row ‰∏≠ÈúÄË¶ÅÊó∂Áõ¥Êé•‰ΩøÁî®
- (NSUInteger)getDaysOfCurrentMonthInSection:(NSInteger)section
{
    // ÂΩìÊúà
    NSString *month = [NSString stringWithFormat:@"%@", self.monthArray[section]];
    
    // ÂΩìÊúà ÂΩìÊó• date
    NSDate *dateForSection = [self getDateWithYear:self.year month:month day:month];
    
    // ÂΩìÊúàÂ§©Êï∞
    NSUInteger days = [MRCalendar getCalendarRangeOfUnit:NSCalendarUnitDay
                                                  inUnit:NSCalendarUnitMonth
                                                 forDate:dateForSection].length;
    return days;
}

// ËøôÈÉ®ÂàÜÊï∞ÊçÆÂ∫îËØ•Âú®ËØ• section ËÆ°ÁÆóÂÆå‰πãÂêé‰øùÂ≠òËµ∑Êù•, ÂΩì row ‰∏≠ÈúÄË¶ÅÊó∂Áõ¥Êé•‰ΩøÁî®
- (NSUInteger)getDaysOfLastMonthInSection:(NSInteger)section
{
    // ÂΩìÂâç setcion ‰∏≠Â±ïÁ§∫ÁöÑÊúà
    NSString *month = [NSString stringWithFormat:@"%@", self.monthArray[section]];
    
    // ÂΩìÂâç section ‰∏≠Â±ïÁ§∫ÁöÑÊúàÁöÑ date
    NSDate *dateForSection = [self getDateWithYear:self.year month:month day:month];
    
    // ÂΩìÂâç section ‰∏≠Â±ïÁ§∫ÁöÑÊúàÁöÑÂâç‰∏Ä‰∏™ÊúàÁöÑ dateComponents
    NSDateComponents *dateComponentsForSection = [MRCalendar getDateComponentsWithDate:dateForSection];
    [dateComponentsForSection setMonth:dateComponentsForSection.month - 1];
    
    // ÂΩìÂâç section ‰∏≠Â±ïÁ§∫ÁöÑÊúàÁöÑÂâç‰∏Ä‰∏™ÊúàÁöÑ dateComponents ÁöÑ date
    // ** ÂΩì month ÂèëÁîüÊîπÂèò, ÂèØËÉΩÂ∑≤ÁªèË∑®Âπ¥ **
    NSDate *lastMonthOfDateforSection = [MRCalendar getDateWithDateComponents:dateComponentsForSection];
    
    // ‰∏äÊúàÂ§©Êï∞
    NSUInteger days = [MRCalendar getCalendarRangeOfUnit:NSCalendarUnitDay
                                                  inUnit:NSCalendarUnitMonth
                                                 forDate:lastMonthOfDateforSection].length;
    // ‰∏äÊúàÊúÄÂêé‰∏ÄÂ§©ÁöÑ date
    NSDate *lastDayDate = [self getDateWithYear:[NSString stringWithFormat:@"%d", (unsigned)dateComponentsForSection.year]
                                          month:[NSString stringWithFormat:@"%d", (unsigned)dateComponentsForSection.month]
                                            day:[NSString stringWithFormat:@"%d", (unsigned)days]];
    
    // ‰∏äÊúàÁöÑÊúÄÂêé‰∏ÄÂ§©ÁöÑ date ÁöÑ dateComponents
    NSDateComponents *dateComponents = [MRCalendar getDateComponentsWithDate:lastDayDate];
    
    // ‰∏äÊúàÁöÑÊúÄÂêé‰∏ÄÂ§©ÁöÑÊòüÊúü weekday
    NSUInteger componentsWeekday = dateComponents.weekday;
    
    NSUInteger currentRuleWeekday = [[self getWeekdays][componentsWeekday - 1] integerValue];
    
    // Ëé∑Âèñ weekday Âú®ÂΩìÂâç weekdays ËßÑÂàô(‰∏ÄÂë®ÁöÑÁ¨¨‰∏ÄÂ§©ÊòØÊòüÊúüÂá†)Êï∞ÁªÑ‰∏≠ÁöÑÂ∫èÂè∑, Â¶ÇÊûú‰Ωç‰∫éÊú´‰Ωç, ËØ¥Êòé‰∏ä‰∏™ÊúàÊï¥Â•Ω‰ª•Âë®Êú´ÁªìÊùü, Âê¶Âàô, Â∞±Â¢ûÂä†ÂØπÂ∫îÁöÑÂ§©Êï∞
    
    NSUInteger weekdayIndexOfCurrentRulesWeekdays = [[self getWeekdays] indexOfObject:@(currentRuleWeekday)];
    
    // ÈùûÊú´‰Ωç, Âç≥ÈùûÂΩìÂâçËßÑÂàô‰∏≠‰∏ÄÂë®ÁöÑÊúÄÂêé‰∏ÄÂ§©.
    if (weekdayIndexOfCurrentRulesWeekdays != [self getDayCountOfWeek] - 1) {
        
        // Ëøô‰∏™ days Â∞±ÊòØÂΩìÊúà1Âè∑ÊâÄÂØπÂ∫îÁöÑÊòüÊúüÂá†‰πãÂâçÁöÑÈÇ£Âá†Â§©
        return weekdayIndexOfCurrentRulesWeekdays + 1;
        
    } else {
        
        return 0;
        
    }
}

- (NSArray *)getSegmentationArrayWithConsecutiveNumberInArray:(NSArray *)numberArray
{
    NSUInteger count = numberArray.count;
    
    NSUInteger previousValue = 0;
    
    NSMutableArray *larger = [NSMutableArray array];
    
    NSMutableArray *smaller = nil;
    
    for (int idx = 0; idx < count; idx++) {
        
        if (idx == 0) {
            
            smaller = [NSMutableArray array];
            [smaller addObject:numberArray[idx]];
            [larger addObject:smaller];
            
        } else {
            
            // Â¶ÇÊûúËøûÁª≠
            if ([numberArray[idx] integerValue] - previousValue == 1) {
                
                [smaller addObject:numberArray[idx]];
                
            } else {
                
                smaller = [NSMutableArray array];
                [smaller addObject:numberArray[idx]];
                [larger addObject:smaller];
                
            }
            
        }
        
        previousValue = [numberArray[idx] integerValue];
        
    }
    
    return self.segmentationDayArray = [NSArray arrayWithArray:larger];
}

- (NSDictionary *)getItemCoverViewStyleDictionaryWithSegmentationArray:(NSArray<__kindof NSArray *> *)dayArray
{
    NSMutableDictionary *coverViewStyleDictionary = [NSMutableDictionary dictionary];
    
    [dayArray enumerateObjectsUsingBlock:^(NSArray * _Nonnull segment, NSUInteger idx, BOOL * _Nonnull stop) {
        
        if (segment.count == 1) {
            
            coverViewStyleDictionary[segment.firstObject] = MRCalendarItemCoverViewStyleDirectionClose;
            
        } else if (segment.count == 2) {
            
            coverViewStyleDictionary[segment.firstObject] = MRCalendarItemCoverViewStyleDirectionRight;
            
            coverViewStyleDictionary[segment.lastObject] = MRCalendarItemCoverViewStyleDirectionLeft;
            
        } else {
            
            [segment enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
                
                if (idx == 0) {
                    
                    coverViewStyleDictionary[obj] = MRCalendarItemCoverViewStyleDirectionRight;
                    
                } else if (idx == segment.count - 1) {
                    
                    coverViewStyleDictionary[obj] = MRCalendarItemCoverViewStyleDirectionLeft;
                    
                } else {
                    
                    coverViewStyleDictionary[obj] = MRCalendarItemCoverViewStyleDirectionLeftAndRight;
                    
                }
                
            }];
            
        }
        
    }];
    
    return coverViewStyleDictionary;
}

#pragma mark - <UICollectionViewDelegateFlowLayout>

- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath
{
    
    CGFloat availableCollectionWidth = CGRectGetWidth(self.bounds) - _leftSpacing - _rightSpacing;
    
    CGFloat availableItemFloatWidth = availableCollectionWidth / [self getDayCountOfWeek];
    
    NSUInteger availableItemIntegerWidth = availableCollectionWidth / [self getDayCountOfWeek];
    
    BOOL availableItemWidthIsInteger = availableItemFloatWidth == availableItemIntegerWidth;
    
    if (!availableItemWidthIsInteger) {
        
        CGFloat restWidth = availableCollectionWidth - availableItemIntegerWidth * [self getDayCountOfWeek];
        
        _leftSpacing = _leftSpacing + restWidth / 2.0f;
        
        _rightSpacing = _rightSpacing + restWidth / 2.0f;
        
    }
    
    return CGSizeMake(availableItemIntegerWidth, availableItemIntegerWidth);
    
}

- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout insetForSectionAtIndex:(NSInteger)section
{
    return UIEdgeInsetsMake(self.topSpacing,
                            self.leftSpacing,
                            self.bottomSpacing,
                            self.rightSpacing);
}

- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section
{
    return self.minLineSpacing;
}

- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section
{
    return 0;
}

- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout referenceSizeForHeaderInSection:(NSInteger)section
{
    return CGSizeMake(CGRectGetWidth(collectionView.bounds), 50.0f);
}

#pragma mark - <UICollectionViewDataSource>

- (UICollectionReusableView *)collectionView:(UICollectionView *)collectionView viewForSupplementaryElementOfKind:(NSString *)kind atIndexPath:(NSIndexPath *)indexPath
{
    if (kind == UICollectionElementKindSectionHeader) {
        
        MRCalendarMonthItem *monthItem = [self dequeueReusableSupplementaryViewOfKind:kind withReuseIdentifier:@"Month" forIndexPath:indexPath];
        
        monthItem.year = [NSString stringWithFormat:@"%@Âπ¥", self.year];
        
        NSString *month = self.monthArray[indexPath.row];
        
        monthItem.month = [NSString stringWithFormat:@"%@Êúà", month];
        
        return monthItem;
        
    } else {
        return nil;
    }
}

- (NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView
{
    return self.monthArray.count;
}

- (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section
{
    
    NSInteger number = 0;
    
    // Â¢ûÂä†ÊòæÁ§∫ÊòüÊúü "[Êó•, ÂÖ≠]" ÁöÑÂ§©Êï∞
    number += [self getDayCountOfWeek];
    
    // Â¢ûÂä†Êú¨ÊúàÂ§©Êï∞
    number += [self getDaysOfCurrentMonthInSection:section];
    
    // Â¢ûÂä†ÂΩìÊúà1Âè∑ÂØπÂ∫îÁöÑÊòüÊúüÂá†‰πãÂâçÁöÑÂ§©Êï∞
    number += [self getDaysOfLastMonthInSection:section];
    
    // Â¢ûÂä†Êú¨ÊúàÊú´Â∞æÊòüÊúü‰∏≠Ë¢´‰∏ã‰∏™ÊúàÂç†Áî®ÁöÑÂ§©Êï∞
    // ÊöÇÊó∂ÂÖà‰∏çÂä†
    number += 0;
    
    return number;
}

- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath
{
    MRCalendarItem *item = [collectionView dequeueReusableCellWithReuseIdentifier:@"Day" forIndexPath:indexPath];
    
    return item;
}

- (void)collectionView:(UICollectionView *)collectionView willDisplayCell:(MRCalendarItem *)cell forItemAtIndexPath:(NSIndexPath *)indexPath
{
    [self configWeekIfNeedWithCollectionView:collectionView item:cell indexPath:indexPath];
}

#pragma mark - CONFIG CELL UI

- (void)configWeekIfNeedWithCollectionView:(UICollectionView *)collectionView item:(MRCalendarItem *)item indexPath:(NSIndexPath *)indexPath
{
    item.coverStyle = MRCalendarItemCoverViewStyleNone;
    
    item.itemStyle = MRCalendarItemStyleDefault;
    
    item.title = @"";
    
    NSUInteger daysOfCurrentMonthInSection = [self getDaysOfCurrentMonthInSection:indexPath.section];
    
    NSUInteger daysOfLastMonthInSection = [self getDaysOfLastMonthInSection:indexPath.section];
    
    // [0, 6] is weekday index path
    if (indexPath.row >= 0 && indexPath.row <= 6) {
        
        NSString *weekdayArabicNumber = [NSString stringWithFormat:@"%@", [self getWeekdays][indexPath.row]];
        
        item.title = [self getWeekdaysArabicNumberToChineseDictionary][weekdayArabicNumber];
        
        item.itemStyle = MRCalendarItemStyleWeekday;
        
    // (6, (6 + daysOfLastMonthInSection)] is days of last month index path
    } else if (indexPath.row <= (6 + daysOfLastMonthInSection)) {
        
        // ÊöÇÊó∂ÂÖà‰∏çÊòæÁ§∫ÂÖ∑‰ΩìÊòØÂá†Âè∑Âà∞Âá†Âè∑, ‰πãÂêéÊúâÁ©∫ÂÜçËÆ°ÁÆó
        item.title = @"";
        
        item.coverStyle = MRCalendarItemCoverViewStyleNone;
        
    // (daysOfLastMonthInSection, (daysOfLastMonthInSection + daysOfLastMonthInSection)] is days of current month index path
    } else if (indexPath.row <= (6 + daysOfLastMonthInSection + daysOfCurrentMonthInSection)) {
        
        NSUInteger day = indexPath.row - 6 - daysOfLastMonthInSection;
     
        item.title = [NSString stringWithFormat:@"%d", (unsigned)day];
        
        NSString *dayDescription = [NSString stringWithFormat:@"%d", (unsigned)day];
        
        NSString *style = [self.itemCoverViewStyleDictionary objectForKey:dayDescription];
        
        item.coverStyle = style;

    } else {
        
        // ÊöÇÊó∂ÂÖà‰∏çÊòæÁ§∫
        item.title = @"";
        
        item.coverStyle = MRCalendarItemCoverViewStyleNone;
        
    }
}

@end
